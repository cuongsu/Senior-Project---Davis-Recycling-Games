<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Zero Waste Games</title>
    <style>
        *{padding: 0; margin: 0;}
        canvas{background: #FFFFFF; display: block; margin: 0 auto;}
    </style>
</head>
<body>

<canvas id="myCanvas" width="960" height="640"></canvas>

<script src="Classes/Tile.js"></script>
<script src="Classes/Timer.js"></script>
<script src="Classes/CircularButton.js"></script>
<script src="Classes/RectangularButton.js"></script>
<script src="Classes/Garbage.js"></script>

<script>
var dCanvas = document.getElementById("myCanvas");
var dCtx = dCanvas.getContext("2d");

document.addEventListener("mousedown", clickHandler, false);

document.addEventListener("mousedown", mouseDownHandler, false);
document.addEventListener("mousemove", mouseMoveHandler, false);
document.addEventListener("mouseup", mouseUpHandler, false);

document.addEventListener("touchstart", touch2Mouse, true);
document.addEventListener("touchmove", touch2Mouse, true);
document.addEventListener("touchend", touch2Mouse, true);

var canvas = document.createElement('canvas');
var ctx = canvas.getContext("2d");
canvas.width = 960;
canvas.height = 640;

var state = {WELCOME1: 0, WELCOME2: 1, CHOOSEGAME: 2, MATCHINTRO1: 3, MATCHINTRO2: 4, MATCHINTRO3: 5, MATCHLEVEL: 6, PLAYMATCH: 7, END: 8, SORTINTRO1: 9, SORTINTRO2: 10, SORTLEVEL: 11, PLAYSORT: 12, MAININTRO: 13, LOADING: 14};

var currentState = state.LOADING;

var mouseDown = false;

var percent;
var timerBarHeight = 30;
var timerBarWidth = 0;

var score = 0;

var level;

var gameTitle;

var timer = new Timer();
var timerTime;
var timeElapsed = Number(0).toFixed(2);

var chooseButtonSize = 200;
var originalPlayButtonSize = 100;
var soundButtonSize = 75;
var currentPlayButtonSize = originalPlayButtonSize;
var sortButtonSize = 75;

var levelButtonWidth = 125;
var levelButtonHeight = 50;

var increaseChooseButtonSize = true;
var increasePlayButtonSize = true;
var increaseLevelButtonSize = true;

var tileRowCount;
var tileColumnCount;
var tileSize;
var tilePadding;
var tileOffsetTop;
var tileOffsetLeft;

var tiles;

var backgroundMusic = new Audio();
var matchingMusic = new Audio();

var sortingMusic = new Audio();

var buttonSound = new Audio();
var tileFlipSound = new Audio();
var tileMatchSound = new Audio();

var muted = false;

var loadingImg = image("Images/Screens/loadScreen.png");
var mainIntroImg = new Image();
var welcome1Img = new Image();
var welcome2Img = new Image();
var chooseGameImg = new Image();
var matchingIntro1Img = new Image();
var matchingIntro2Img = new Image();
var matchingIntro3Img = new Image();
var matchingLevelSelectImg = new Image();
var endScreenMatchingImg = new Image();
var sortingIntro1Img = new Image();
var sortingIntro2Img = new Image();
var sortingLevelSelectImg = new Image();
var endScreenSortingImg = new Image();
var pauseScreenImg = new Image();

var matchingButtonImg = new Image();
var sortingButtonImg = new Image();
var muteImg = new Image();
var unmuteImg = new Image();
var pauseButtonImg = new Image();
var playButtonImg = new Image();
var level1Img = new Image();
var level2Img = new Image();
var level3Img = new Image();
var restartButtonImg = new Image();
var homeButtonImg = new Image();

var bananaMatchImg = new Image();
var bottleMatchImg = new Image();
var chipsMatchImg = new Image();
var grassMatchImg = new Image();
var newsPaperMatchImg = new Image();
var paperCupMatchImg = new Image();
var paperTowelsMatchImg = new Image();
var plasticBagMatchImg = new Image();
var strawAndLidMatchImg = new Image();
var appleMatchImg = new Image();
var bonesMatchImg = new Image();
var coffeeLidMatchImg = new Image();
var glassJarMatchImg = new Image();
var mailMatchImg = new Image();
var milkCartonMatchImg = new Image();
var paperPlatesMatchImg = new Image();
var petWasteMatchImg = new Image();
var takeOutBoxMatchImg = new Image();
var paperBagMatchImg = new Image();
var sodaCanMatchImg = new Image();
var brokenPlateMatchImg = new Image();
var canMatchImg = new Image();
var cardboardMatchImg = new Image();
var cerealMatchImg = new Image();
var diaperMatchImg = new Image();
var glassBottleMatchImg = new Image();
var pumpkinMatchImg = new Image();
var styrofoamMatchImg = new Image();
var leafMatchImg = new Image();
var papersMatchImg = new Image();
var juiceMatchImg = new Image();
var eggsMatchImg = new Image();
var stickMatchImg = new Image();
var candyMatchImg = new Image();
var paperRollMatchImg = new Image();
var paperBagMatchImg = new Image();
var aluminumFoilMatchImg = new Image();

var bananaGSImg = new Image();
var bottleGSImg = new Image();
var chipsGSImg = new Image();
var newsPaperGSImg = new Image();
var sodaCanGSImg = new Image();
var appleGSImg = new Image();
var brokenPlateGSImg = new Image();
var canGSImg = new Image();
var cardboardGSImg = new Image();
var cerealGSImg = new Image();
var diaperGSImg = new Image();
var glassBottleGSImg = new Image();
var glassJarGSImg = new Image();
var grassGSImg = new Image();
var leafGSImg = new Image();
var mailGSImg = new Image();
var papersGSImg = new Image();
var plasticBagGSImg = new Image();
var pumpkinGSImg = new Image();
var styrofoamGSImg = new Image();
var milkGSImg = new Image();
var juiceGSImg = new Image();
var eggsGSImg = new Image();
var strawGSImg = new Image();
var chineseGSImg = new Image();
var stickGSImg = new Image();
var candyGSImg = new Image();
var poopGSImg = new Image();
var paperRollGSImg = new Image();
var paperBagGSImg = new Image();
var aluminumFoilGSImg = new Image();
var coffeeLidGSImg = new Image();

var matchingCardImg = new Image();
var cardFrontImg = new Image();
var sortingBackgroundImg = new Image();
var paperBackImg = new Image();
var paperFrontImg = new Image();
var comingledBackImg = new Image();
var comingledFrontImg = new Image();
var organicsBackImg = new Image();
var organicsFrontImg = new Image();
var landfillBackImg = new Image();
var landfillFrontImg = new Image();


var numberLoaded = 0;
var numberOfAssets = 104;

function loadAssets(){

    var finishedLoading = function(){
        numberLoaded++;
    };

    //Images
    mainIntroImg.onload = finishedLoading;
    welcome1Img.onload = finishedLoading;
    welcome2Img.onload = finishedLoading;
    chooseGameImg.onload = finishedLoading;
    matchingIntro1Img.onload = finishedLoading;
    matchingIntro2Img.onload = finishedLoading;
    matchingIntro3Img.onload = finishedLoading;
    matchingLevelSelectImg.onload = finishedLoading;
    endScreenMatchingImg.onload = finishedLoading;
    sortingIntro1Img.onload = finishedLoading;
    sortingIntro2Img.onload = finishedLoading;
    sortingLevelSelectImg.onload = finishedLoading;
    endScreenSortingImg.onload = finishedLoading;
    pauseScreenImg.onload = finishedLoading;

    matchingButtonImg.onload = finishedLoading;
    sortingButtonImg.onload = finishedLoading;
    muteImg.onload = finishedLoading;
    unmuteImg.onload = finishedLoading;
    pauseButtonImg.onload = finishedLoading;
    playButtonImg.onload = finishedLoading;
    level1Img.onload = finishedLoading;
    level2Img.onload = finishedLoading;
    level3Img.onload = finishedLoading;
    restartButtonImg.onload = finishedLoading;
    homeButtonImg.onload = finishedLoading;

    bananaMatchImg.onload = finishedLoading;
    bottleMatchImg.onload = finishedLoading;
    chipsMatchImg.onload = finishedLoading;
    grassMatchImg.onload = finishedLoading;
    newsPaperMatchImg.onload = finishedLoading;
    paperCupMatchImg.onload = finishedLoading;
    paperTowelsMatchImg.onload = finishedLoading;
    plasticBagMatchImg.onload = finishedLoading;
    strawAndLidMatchImg.onload = finishedLoading;
    appleMatchImg.onload = finishedLoading;
    bonesMatchImg.onload = finishedLoading;
    coffeeLidMatchImg.onload = finishedLoading;
    glassJarMatchImg.onload = finishedLoading;
    mailMatchImg.onload = finishedLoading;
    milkCartonMatchImg.onload = finishedLoading;
    paperPlatesMatchImg.onload = finishedLoading;
    petWasteMatchImg.onload = finishedLoading;
    takeOutBoxMatchImg.onload = finishedLoading;
    paperBagMatchImg.onload = finishedLoading;
    sodaCanMatchImg.onload = finishedLoading;
    brokenPlateMatchImg.onload = finishedLoading;
    canMatchImg.onload = finishedLoading;
    cardboardMatchImg.onload = finishedLoading;
    cerealMatchImg.onload = finishedLoading;
    diaperMatchImg.onload = finishedLoading;
    glassBottleMatchImg.onload = finishedLoading;
    pumpkinMatchImg.onload = finishedLoading;
    styrofoamMatchImg.onload = finishedLoading;
    leafMatchImg.onload = finishedLoading;
    papersMatchImg.onload = finishedLoading;
    juiceMatchImg.onload = finishedLoading;
    eggsMatchImg.onload = finishedLoading;
    stickMatchImg.onload = finishedLoading;
    candyMatchImg.onload = finishedLoading;
    paperRollMatchImg.onload = finishedLoading;
    paperBagMatchImg.onload = finishedLoading;
    aluminumFoilMatchImg.onload = finishedLoading;

    bananaGSImg.onload = finishedLoading;
    bottleGSImg.onload = finishedLoading;
    chipsGSImg.onload = finishedLoading;
    newsPaperGSImg.onload = finishedLoading;
    sodaCanGSImg.onload = finishedLoading;
    appleGSImg.onload = finishedLoading;
    brokenPlateGSImg.onload = finishedLoading;
    canGSImg.onload = finishedLoading;
    cardboardGSImg.onload = finishedLoading;
    cerealGSImg.onload = finishedLoading;
    diaperGSImg.onload = finishedLoading;
    glassBottleGSImg.onload = finishedLoading;
    glassJarGSImg.onload = finishedLoading;
    grassGSImg.onload = finishedLoading;
    leafGSImg.onload = finishedLoading;
    mailGSImg.onload = finishedLoading;
    papersGSImg.onload = finishedLoading;
    plasticBagGSImg.onload = finishedLoading;
    pumpkinGSImg.onload = finishedLoading;
    styrofoamGSImg.onload = finishedLoading;
    milkGSImg.onload = finishedLoading;
    juiceGSImg.onload = finishedLoading;
    eggsGSImg.onload = finishedLoading;
    strawGSImg.onload = finishedLoading;
    chineseGSImg.onload = finishedLoading;
    stickGSImg.onload = finishedLoading;
    candyGSImg.onload = finishedLoading;
    poopGSImg.onload = finishedLoading;
    paperRollGSImg.onload = finishedLoading;
    paperBagGSImg.onload = finishedLoading;
    aluminumFoilGSImg.onload = finishedLoading;
    coffeeLidGSImg.onload = finishedLoading;

    matchingCardImg.onload = finishedLoading;
    cardFrontImg.onload = finishedLoading;
    sortingBackgroundImg.onload = finishedLoading;
    paperBackImg.onload = finishedLoading;
    paperFrontImg.onload = finishedLoading;
    comingledBackImg.onload = finishedLoading;
    comingledFrontImg.onload = finishedLoading;
    organicsBackImg.onload = finishedLoading;
    organicsFrontImg.onload = finishedLoading;
    landfillBackImg.onload = finishedLoading;
    landfillFrontImg.onload = finishedLoading;

    mainIntroImg.src = "Images/Screens/mainIntro.png";
    welcome1Img.src = "Images/Screens/welcome1.png";
    welcome2Img.src = "Images/Screens/welcome2.png";
    chooseGameImg.src = "Images/Screens/chooseGame.png";
    matchingIntro1Img.src = "Images/Screens/matchingIntro1.png";
    matchingIntro2Img.src = "Images/Screens/matchingIntro2.png";
    matchingIntro3Img.src = "Images/Screens/matchingIntro3.png";
    matchingLevelSelectImg.src = "Images/Screens/chooseLevelMatching.png";
    endScreenMatchingImg.src = "Images/Screens/endScreenMatching.png";
    sortingIntro1Img.src = "Images/Screens/sortingIntro1.png";
    sortingIntro2Img.src = "Images/Screens/sortingIntro2.png";
    sortingLevelSelectImg.src = "Images/Screens/chooseLevelSorting.png";
    endScreenSortingImg.src = "Images/Screens/endScreenSorting.png";
    pauseScreenImg.src = "Images/Screens/pauseScreen.png";

    matchingButtonImg.src = "Images/Buttons/matchingButton.png";
    sortingButtonImg.src = "Images/Buttons/sortingButton.png";
    muteImg.src = "Images/Buttons/muteButton.png";
    unmuteImg.src = "Images/Buttons/unmuteButton.png";
    pauseButtonImg.src = "Images/Buttons/pauseButton.png";
    playButtonImg.src = "Images/Buttons/playButton.png";
    level1Img.src = "Images/Buttons/level1.png";
    level2Img.src = "Images/Buttons/level2.png";
    level3Img.src = "Images/Buttons/level3.png";
    restartButtonImg.src = "Images/Buttons/restartButton.png";
    homeButtonImg.src = "Images/Buttons/homeButton.png";

    bananaMatchImg.src = "Images/Clear/bananaPeelClr.png";
    bottleMatchImg.src = "Images/Clear/bottleClr.png";
    chipsMatchImg.src = "Images/Clear/chipsClr.png";
    grassMatchImg.src = "Images/Clear/grassClr.png";
    newsPaperMatchImg.src = "Images/Clear/newsPaperClr.png";
    paperCupMatchImg.src = "Images/Clear/paperCupClr.png";
    paperTowelsMatchImg.src = "Images/Clear/paperTowelsClr.png";
    plasticBagMatchImg.src = "Images/Clear/plasticBagClr.png";
    strawAndLidMatchImg.src = "Images/Clear/StrawAndLidClr.png";
    appleMatchImg.src = "Images/Clear/appleClr.png";
    bonesMatchImg.src = "Images/Clear/bonesClr.png";
    coffeeLidMatchImg.src = "Images/Clear/coffeeLidClr.png";
    glassJarMatchImg.src = "Images/Clear/glassJarClr.png";
    mailMatchImg.src = "Images/Clear/mailClr.png";
    milkCartonMatchImg.src = "Images/Clear/milkCartonClr.png";
    paperPlatesMatchImg.src = "Images/Clear/paperPlatesClr.png";
    petWasteMatchImg.src = "Images/Clear/petWasteClr.png";
    takeOutBoxMatchImg.src = "Images/Clear/takeOutClr.png";
    paperBagMatchImg.src = "Images/Clear/paperBagClr.png";
    sodaCanMatchImg.src = "Images/Clear/sodaCanClr.png";
    brokenPlateMatchImg.src = "Images/Clear/brokenPlateClr.png";
    canMatchImg.src = "Images/Clear/canClr.png";
    cardboardMatchImg.src = "Images/Clear/cardboardClr.png";
    cerealMatchImg.src = "Images/Clear/cerealClr.png";
    diaperMatchImg.src = "Images/Clear/diaperClr.png";
    glassBottleMatchImg.src = "Images/Clear/glassBottleClr.png";
    pumpkinMatchImg.src = "Images/Clear/pumpkinClr.png";
    styrofoamMatchImg.src = "Images/Clear/styrofoamClr.png";
    leafMatchImg.src = "Images/Clear/leafClr.png";
    papersMatchImg.src = "Images/Clear/papersClr.png";
    juiceMatchImg.src = "Images/Clear/juiceBoxClr.png";
    eggsMatchImg.src = "Images/Clear/eggCartonClr.png";
    stickMatchImg.src = "Images/Clear/stickClr.png";
    candyMatchImg.src = "Images/Clear/candyBarClr.png";
    paperRollMatchImg.src = "Images/Clear/paperRollClr.png";
    paperBagMatchImg.src = "Images/Clear/paperBagClr.png";
    aluminumFoilMatchImg.src = "Images/Clear/aluminumFoilClr.png";

    bananaGSImg.src = "Images/Grayscale/bananaPeelGS.png";
    bottleGSImg.src = "Images/Grayscale/bottleGS.png";
    chipsGSImg.src = "Images/Grayscale/chipsGS.png";
    newsPaperGSImg.src = "Images/Grayscale/newsPaperGS.png";
    sodaCanGSImg.src = "Images/Grayscale/sodaCanGS.png";
    appleGSImg.src = "Images/Grayscale/appleGS.png";
    brokenPlateGSImg.src = "Images/Grayscale/brokenPlateGS.png";
    canGSImg.src = "Images/Grayscale/canGS.png";
    cardboardGSImg.src = "Images/Grayscale/cardboardGS.png";
    cerealGSImg.src = "Images/Grayscale/cerealGS.png";
    diaperGSImg.src = "Images/Grayscale/diaperGS.png";
    glassBottleGSImg.src = "Images/Grayscale/glassBottleGS.png";
    glassJarGSImg.src = "Images/Grayscale/glassJarGS.png";
    grassGSImg.src = "Images/Grayscale/grassGS.png";
    leafGSImg.src = "Images/Grayscale/leafGS.png";
    mailGSImg.src = "Images/Grayscale/mailGS.png";
    papersGSImg.src = "Images/Grayscale/papersGS.png";
    plasticBagGSImg.src = "Images/Grayscale/plasticBagGS.png";
    pumpkinGSImg.src = "Images/Grayscale/pumpkinGS.png";
    styrofoamGSImg.src = "Images/Grayscale/styrofoamGS.png";
    milkGSImg.src = "Images/Grayscale/milkCartonGS.png";
    juiceGSImg.src = "Images/Grayscale/juiceBoxGS.png";
    eggsGSImg.src = "Images/Grayscale/eggCartonGS.png";
    strawGSImg.src = "Images/Grayscale/StrawAndLidGS.png";
    chineseGSImg.src = "Images/Grayscale/takeOutGS.png";
    stickGSImg.src = "Images/Grayscale/stickGS.png";
    candyGSImg.src = "Images/Grayscale/candyBarGS.png";
    poopGSImg.src = "Images/Grayscale/petWasteGS.png";
    paperRollGSImg.src = "Images/Grayscale/paperRollGS.png";
    paperBagGSImg.src = "Images/Grayscale/paperBagGS.png";
    aluminumFoilGSImg.src = "Images/Grayscale/aluminumFoilGS.png";
    coffeeLidGSImg.src = "Images/Grayscale/coffeeLidGS.png";

    matchingCardImg.src = "Images/Other/matchingCard.png";
    cardFrontImg.src = "Images/Other/cardFront.png";
    sortingBackgroundImg.src = "Images/Other/sortingBackground.png";
    paperBackImg.src = "Images/Other/paperBack.png";
    paperFrontImg.src = "Images/Other/paperFront.png";
    comingledBackImg.src = "Images/Other/comingledBack.png";
    comingledFrontImg.src = "Images/Other/comingledFront.png";
    organicsBackImg.src = "Images/Other/organicsBack.png";
    organicsFrontImg.src = "Images/Other/organicsFront.png";
    landfillBackImg.src = "Images/Other/landfillBack.png";
    landfillFrontImg.src = "Images/Other/landfillFront.png";

    //Audio
    backgroundMusic.loop = true;
    backgroundMusic.src = "Sound/bgMusic.mp3";
    matchingMusic.loop = true;
    matchingMusic.src = "Sound/matchingMusic.mp3";
    sortingMusic.loop = true;
    sortingMusic.src = "Sound/sortingMusic.mp3";
    buttonSound.src = "Sound/buttonPop.mp3";
    tileFlipSound.src = "Sound/swish.mp3";
    tileMatchSound.src = "Sound/ding.mp3";
}

var dragImg;
var dragX;
var dragY;
var dragOffsetX;
var dragOffsetY;
var draggedGarbage = new Garbage(0, 0, 0, 0, 0);

var binWidth = 960 / 5;
var binBackHeight = 25;
var binFrontHeight = 100;

var sidebarLocalXOrigin = canvas.width - binWidth;
var sidebarWidth = binWidth;
var sidebarButtonSize = 60;

var garbageSize = 75;

var paper = 0;
var comingled = 1;
var organics = 2;
var landfill = 3;

var recyclingSorted = 0;
var landfillSorted = 0;
var scorePercentage = 0;

var paperColumnStart = 0;
var comingledColumnStart = binWidth;
var organicsColumnStart = binWidth * 2;
var landfillColumnStart = binWidth * 3;

var paperColumnEnd = paperColumnStart + binWidth;
var comingledColumnEnd = comingledColumnStart + binWidth;
var organicsColumnEnd = organicsColumnStart + binWidth;
var landfillColumnEnd = landfillColumnStart + binWidth;

var displayMatchInfo;
var matchInfoImage;
var matchInfoString1;
var matchInfoString2;

var imageIndex;
var numberTilesFlipped;
var firstFlippedTileIndex;
var secondFlippedTileIndex;

var timerCircleRadius = 60;
var startAngle = -(Math.PI / 2);
var endAngle = 0;

var fallSpeed;
var dropGarbageInterval;
var lastDropTime;

var garbage = [];
var garbageQueue = [];

var startingGarbageCount;
var itemsRemaining;

var matchingButton = new RectangularButton(canvas.width / 4 - chooseButtonSize / 2, canvas.height / 4 - chooseButtonSize / 2, chooseButtonSize, chooseButtonSize, matchingButtonImg);

var sortingButton = new RectangularButton(canvas.width / 2 + canvas.width / 4 - chooseButtonSize / 2, canvas.height / 4 - chooseButtonSize / 2, chooseButtonSize, chooseButtonSize, sortingButtonImg);

var playButton = new CircularButton(canvas.width / 2 - originalPlayButtonSize - originalPlayButtonSize / 2, canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2, originalPlayButtonSize, playButtonImg);

var level1Button = new RectangularButton(canvas.width / 4 - levelButtonWidth / 2 - levelButtonWidth, canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2, levelButtonWidth, levelButtonHeight, level1Img);

var level2Button = new RectangularButton(canvas.width / 4, canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2, levelButtonWidth, levelButtonHeight, level2Img);

var level3Button = new RectangularButton(canvas.width / 4 + levelButtonWidth / 2 + levelButtonWidth, canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2, levelButtonWidth, levelButtonHeight, level3Img);

var pauseButton = new CircularButton(canvas.width - (originalPlayButtonSize * 2), canvas.height - originalPlayButtonSize - 15, originalPlayButtonSize, pauseButtonImg);

var restartButton = new CircularButton(canvas.width / 4 - originalPlayButtonSize / 2, canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2, originalPlayButtonSize, restartButtonImg);

var homeButton = new CircularButton(canvas.width / 3 + originalPlayButtonSize / 2, canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2, originalPlayButtonSize, homeButtonImg);

var muteButton = new CircularButton(canvas.width - soundButtonSize - soundButtonSize / 8, soundButtonSize / 8, soundButtonSize, muteImg);

var images = [];

function setMatchLevelBoard()
{
    tiles = [];
    displayMatchInfo = false;
    score = 0;
    imageIndex = 0;
    numberTilesFlipped = 0;
    firstFlippedTileIndex = 0;
    secondFlippedTileIndex = 0;
    gameTitle = "matching";

    if(level == 1)
    {
        timerTime = 60000;
        tileRowCount = 3;
        tileColumnCount = 6;
        tileSize = 120;
        tilePadding = 15;
        tileOffsetTop = 120;
        tileOffsetLeft = 75;
        images = [bananaMatchImg, bananaMatchImg, bottleMatchImg, bottleMatchImg, chipsMatchImg, chipsMatchImg, grassMatchImg, grassMatchImg, newsPaperMatchImg, newsPaperMatchImg, paperCupMatchImg, paperCupMatchImg, paperTowelsMatchImg, paperTowelsMatchImg, plasticBagMatchImg, plasticBagMatchImg, strawAndLidMatchImg, strawAndLidMatchImg];
        images.sort(function(){return 0.5 - Math.random();});
    }

    if(level == 2)
    {
        timerTime = 75000;
        tileRowCount = 3;
        tileColumnCount = 8;
        tileSize = 95;
        tilePadding = 15;
        tileOffsetTop = 150;
        tileOffsetLeft = 50;
        images = [appleMatchImg, appleMatchImg, paperTowelsMatchImg, paperTowelsMatchImg, milkCartonMatchImg, milkCartonMatchImg, paperPlatesMatchImg, paperPlatesMatchImg, glassJarMatchImg, glassJarMatchImg, takeOutBoxMatchImg, takeOutBoxMatchImg, bonesMatchImg, bonesMatchImg, petWasteMatchImg, petWasteMatchImg, coffeeLidMatchImg, coffeeLidMatchImg, mailMatchImg, mailMatchImg, paperCupMatchImg, paperCupMatchImg, newsPaperMatchImg, newsPaperMatchImg];
        images.sort(function(){return 0.5 - Math.random();});
    }

    if(level == 3)
    {
        timerTime = 90000;
        tileRowCount = 4;
        tileColumnCount = 8;
        tileSize = 90;
        tilePadding = 15;
        tileOffsetTop = 105;
        tileOffsetLeft = 70;
        images = [appleMatchImg, appleMatchImg, paperTowelsMatchImg, paperTowelsMatchImg, milkCartonMatchImg, milkCartonMatchImg, paperPlatesMatchImg, paperPlatesMatchImg, glassJarMatchImg, glassJarMatchImg, sodaCanMatchImg, sodaCanMatchImg, paperBagMatchImg, paperBagMatchImg, petWasteMatchImg, petWasteMatchImg, coffeeLidMatchImg, coffeeLidMatchImg, mailMatchImg, mailMatchImg, paperCupMatchImg, paperCupMatchImg, newsPaperMatchImg, newsPaperMatchImg, plasticBagMatchImg, plasticBagMatchImg, bonesMatchImg, bonesMatchImg, brokenPlateMatchImg, brokenPlateMatchImg, takeOutBoxMatchImg, takeOutBoxMatchImg];
        images.sort(function(){return 0.5 - Math.random();});
    }

    for(i = 0; i < tileColumnCount; i++)
    {
        for(j = 0; j < tileRowCount; j++)
        {
            tiles.push(new Tile((i * (tileSize + tilePadding)) + tileOffsetLeft, (j * (tileSize + tilePadding)) + tileOffsetTop, tileSize, images[imageIndex]));

            imageIndex++;
        }
    }

    for(i = 0; i < tiles.length; i++)
    {
        tiles[i].flipped = false;
        tiles[i].matched = false;
    }
}

function setSortLevelBoard()
{
    if(level == 1)
    {
        timerTime = 60000;
        dropGarbageInterval = 2000;
        garbageQueue = [new Garbage(getRandomPaperX(), -garbageSize, garbageSize, newsPaperMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, cardboardMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, cerealMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, mailMatchImg, paper), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, bottleMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, sodaCanMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, canMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, glassBottleMatchImg, comingled), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, bananaMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, appleMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, grassMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, pumpkinMatchImg, organics), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, chipsMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, brokenPlateMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, diaperMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, plasticBagMatchImg, landfill)];
        garbageQueue.sort(function(a, b){return 0.5 - Math.random();});
    }

    if(level == 2)
    {
        timerTime = 60000;
        dropGarbageInterval = 1500;
        garbageQueue = [new Garbage(getRandomPaperX(), -garbageSize, garbageSize, newsPaperMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, cardboardMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, cerealMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, mailMatchImg, paper), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, bottleMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, sodaCanMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, canMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, glassBottleMatchImg, comingled), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, bananaMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, appleMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, grassMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, pumpkinMatchImg, organics), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, chipsMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, brokenPlateMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, diaperMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, plasticBagMatchImg, landfill), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, eggsMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, papersMatchImg, paper), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, strawAndLidMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, glassJarMatchImg, comingled), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, milkCartonMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, leafMatchImg, organics), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, juiceMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, styrofoamMatchImg, landfill)];
        garbageQueue.sort(function(a, b){return 0.5 - Math.random();});
    }

    if(level == 3)
    {
        timerTime = 60000;
        dropGarbageInterval = 1000;
        garbageQueue = [new Garbage(getRandomPaperX(), -garbageSize, garbageSize, newsPaperMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, cardboardMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, cerealMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, mailMatchImg, paper), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, bottleMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, sodaCanMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, canMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, glassBottleMatchImg, comingled), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, bananaMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, appleMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, grassMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, pumpkinMatchImg, organics), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, chipsMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, brokenPlateMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, diaperMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, plasticBagMatchImg, landfill), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, eggsMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, papersMatchImg, paper), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, strawAndLidMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, glassJarMatchImg, comingled), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, milkCartonMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, leafMatchImg, organics), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, juiceMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, styrofoamMatchImg, landfill), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, paperRollMatchImg, paper), new Garbage(getRandomPaperX(), -garbageSize, garbageSize, paperBagMatchImg, paper), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, aluminumFoilMatchImg, comingled), new Garbage(getRandomComingledX(), -garbageSize, garbageSize, coffeeLidMatchImg, comingled), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, stickMatchImg, organics), new Garbage(getRandomOrganicsX(), -garbageSize, garbageSize, takeOutBoxMatchImg, organics), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, petWasteMatchImg, landfill), new Garbage(getRandomLandfillX(), -garbageSize, garbageSize, candyMatchImg, landfill)];
        garbageQueue.sort(function(a, b){return 0.5 - Math.random();});
    }

    garbage = [];
    fallSpeed = 2;
    lastDropTime = 0;
    recyclingSorted = 0;
    landfillSorted = 0;
    scorePercentage = 0;
    startingGarbageCount = garbageQueue.length;
    itemsRemaining = startingGarbageCount;
    gameTitle = "sorting";
}

function image(imageSrc)
{
    var image = new Image();

    image.src = imageSrc;

    return image;
}

function getRandomPaperX()
{
    var min = binWidth;
    var max = canvas.width - binWidth - garbageSize;
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function getRandomComingledX()
{
    var min1 = 0;
    var max1 = binWidth - garbageSize;
    var min2 = binWidth * 2;
    var max2 = canvas.width - binWidth - garbageSize;
    min1 = Math.ceil(min1);
    max1 = Math.floor(max1);
    min2 = Math.ceil(min2);
    max2 = Math.floor(max2);
    var value1 = Math.floor(Math.random() * (max1 - min1 + 1)) + min1;
    var value2 = Math.floor(Math.random() * (max2 - min2 + 1)) + min2;
    return (Math.random() < 0.5) ? value1 : value2;
}

function getRandomOrganicsX()
{
    var min1 = 0;
    var max1 = (binWidth * 2) - garbageSize;
    var min2 = canvas.width - (binWidth * 2);
    var max2 = canvas.width - binWidth - garbageSize;
    min1 = Math.ceil(min1);
    max1 = Math.floor(max1);
    min2 = Math.ceil(min2);
    max2 = Math.floor(max2);
    var value1 = Math.floor(Math.random() * (max1 - min1 + 1)) + min1;
    var value2 = Math.floor(Math.random() * (max2 - min2 + 1)) + min2;
    return (Math.random() < 0.5) ? value1 : value2;
}

function getRandomLandfillX()
{
    var min = 0;
    var max = canvas.width - (binWidth * 2) - garbageSize;
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function clickHandler(e)
{
    var x = (e.pageX - dCanvas.offsetLeft) * (canvas.width/dCanvas.width);
	var y = (e.pageY - dCanvas.offsetTop) * (canvas.height/dCanvas.height);

    if(currentState == state.PLAYMATCH)
    {
        if(timer.isMatchDelayed())
        {
            timer.endMatchDelay();
            timer.update();
            numberTilesFlipped = 0;
        }
    }

    if(currentState == state.MAININTRO)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                backgroundMusic.play();
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.WELCOME1;

            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.WELCOME1)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.WELCOME2;

            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.WELCOME2)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.CHOOSEGAME;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.CHOOSEGAME)
    {
        if(matchingButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.MATCHINTRO1;

            playButton.x = canvas.width / 2 + canvas.width / 4 - originalPlayButtonSize / 2;
            playButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
        }
        else if(sortingButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.SORTINTRO1;

            playButton.x = canvas.width / 2 - originalPlayButtonSize/2;
            playButton.y = canvas.height / 2 - originalPlayButtonSize/4;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.MATCHINTRO1)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.MATCHINTRO2;

            playButton.x = canvas.width / 2 - originalPlayButtonSize / 2;
            playButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize - originalPlayButtonSize / 8;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.MATCHINTRO2)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.MATCHINTRO3;

            playButton.x = canvas.width / 2 - canvas.width / 4 - originalPlayButtonSize / 2;
            playButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.MATCHINTRO3)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;

            currentState = state.MATCHLEVEL;

            level1Button.x = canvas.width / 4 - levelButtonWidth / 2 - levelButtonWidth;
            level1Button.y = canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2;

            level2Button.x = canvas.width / 4;
            level2Button.y = canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2;

            level3Button.x = canvas.width / 4 + levelButtonWidth / 2 + levelButtonWidth;
            level3Button.y = canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.MATCHLEVEL)
    {
        toggleAudio(x, y);

        if(level1Button.clicked(x, y) || level2Button.clicked(x, y) || level3Button.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            if(level1Button.clicked(x, y))
            {
                level = 1;
            }

            if(level2Button.clicked(x, y))
            {
                level = 2;

            }

            if(level3Button.clicked(x, y))
            {
                level = 3;
            }

            setMatchLevelBoard();

            currentState = state.PLAYMATCH;

            pauseButton.image = pauseButtonImg;
            pauseButton.x = canvas.width - originalPlayButtonSize * 2;
            pauseButton.y = canvas.height - originalPlayButtonSize - 15;

            homeButton.x = canvas.width / 2 - originalPlayButtonSize * 2 - originalPlayButtonSize / 4;
            homeButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            homeButton.size = originalPlayButtonSize;

            restartButton.x = canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
            restartButton.y = canvas.height / 2 - originalPlayButtonSize / 2 - originalPlayButtonSize / 8;
            restartButton.size = originalPlayButtonSize;

            muteButton.x = canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
            muteButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            muteButton.size = originalPlayButtonSize;

            if(!muted)
            {
                backgroundMusic.pause();
                matchingMusic.currentTime = 0;
                matchingMusic.play();
            }

            timer.setTimerTime(timerTime);
            timer.start();
        }
    }
    else if(currentState == state.PLAYMATCH)
    {
    	if(score != tiles.length * 50 / 2)
    	{
        	toggleAudio(x, y);
        }

        for(i = 0; i < tiles.length; i++)
        {
            if(tiles[i].clicked(x, y) && !timer.isPaused() && !tiles[i].flipped && !tiles[i].matched && numberTilesFlipped < 2 && !timer.isMatchDelayed() && !timer.isEndDelayed())
            {
                tiles[i].flipped = true;

                if(numberTilesFlipped == 1)
                {
                    secondFlippedTileIndex = i;
                }
                else
                {
                    if(!muted)
                    {
                        tileFlipSound.load();
                        tileFlipSound.play();
                    }

                    firstFlippedTileIndex = i;
                }

                numberTilesFlipped++;

                if(numberTilesFlipped == 2)
                {
                    if(tiles[firstFlippedTileIndex].image == tiles[secondFlippedTileIndex].image)
                    {
                        if(!muted)
                        {
                            tileMatchSound.load();
                            tileMatchSound.play();
                        }

                        tiles[firstFlippedTileIndex].matched = true;
                        tiles[secondFlippedTileIndex].matched = true;

                        switch(tiles[firstFlippedTileIndex].image)
                        {
                            case bananaMatchImg:
                            matchInfoImage = bananaMatchImg;
                            matchInfoString1 = "Banana peels can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case bottleMatchImg:
                            matchInfoImage = bottleMatchImg;
                            matchInfoString1 = "Plastic bottles can be recycled with other plastics.";
                            matchInfoString2 = "";
                            break;
                            case chipsMatchImg:
                            matchInfoImage = chipsMatchImg;
                            matchInfoString1 = "Chip bags should be placed in the trash.";
                            matchInfoString2 = "";
                            break;
                            case grassMatchImg:
                            matchInfoImage = grassMatchImg;
                            matchInfoString1 = "Grass clippings can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case newsPaperMatchImg:
                            matchInfoImage = newsPaperMatchImg;
                            matchInfoString1 = "Newspaper can be recycled with other papers.";
                            matchInfoString2 = "";
                            break;
                            case paperCupMatchImg:
                            matchInfoImage = paperCupMatchImg;
                            matchInfoString1 = "Coffee cups can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case paperTowelsMatchImg:
                            matchInfoImage = paperTowelsMatchImg;
                            matchInfoString1 = "Paper towels can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case plasticBagMatchImg:
                            matchInfoImage = plasticBagMatchImg;
                            matchInfoString1 = "Plastic bags should be placed in the trash.";
                            matchInfoString2 = "";
                            break;
                            case strawAndLidMatchImg:
                            matchInfoImage = strawAndLidMatchImg;
                            matchInfoString1 = "Plastic straws and disposable cup lids can be";
                            matchInfoString2 = "recycled with other plastics.";
                            break;
                            case coffeeLidMatchImg:
                            matchInfoImage = coffeeLidMatchImg;
                            matchInfoString1 = "Disposable plastic coffee cup lids can be recycled";
                            matchInfoString2 = "with other plastics.";
                            break;
                            case appleMatchImg:
                            matchInfoImage = appleMatchImg;
                            matchInfoString1 = "Apple cores can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case glassJarMatchImg:
                            matchInfoImage = glassJarMatchImg;
                            matchInfoString1 = "Glass food jars can be recycled.";
                            matchInfoString2 = "";
                            break;
                            case mailMatchImg:
                            matchInfoImage = mailMatchImg;
                            matchInfoString1 = "Mail can be recycled with other papers.";
                            matchInfoString2 = "";
                            break;
                            case petWasteMatchImg:
                            matchInfoImage = petWasteMatchImg;
                            matchInfoString1 = "Pet waste should be placed in the trash.";
                            matchInfoString2 = "";
                            break;
                            case paperPlatesMatchImg:
                            matchInfoImage = paperPlatesMatchImg;
                            matchInfoString1 = "Paper plates can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case takeOutBoxMatchImg:
                            matchInfoImage = takeOutBoxMatchImg;
                            matchInfoString1 = "Chopsticks and take-out food boxes can be composted";
                            matchInfoString2 = "with other organics.";
                            break;
                            case bonesMatchImg:
                            matchInfoImage = bonesMatchImg;
                            matchInfoString1 = "Meat and bones can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case milkCartonMatchImg:
                            matchInfoImage = milkCartonMatchImg;
                            matchInfoString1 = "Milk cartons can be composted with other organics.";
                            matchInfoString2 = "";
                            break;
                            case paperBagMatchImg:
                            matchInfoImage = paperBagMatchImg;
                            matchInfoString1 = "Paper bags can be recycled with other papers.";
                            matchInfoString2 = "";
                            break;
                            case sodaCanMatchImg:
                            matchInfoImage = sodaCanMatchImg;
                            matchInfoString1 = "Aluminum cans may be recycled with other metals.";
                            matchInfoString2 = "";
                            break;
                            case brokenPlateMatchImg:
                            matchInfoImage = brokenPlateMatchImg;
                            matchInfoString1 = "Broken dishes and glassware should be placed in";
                            matchInfoString2 = "the trash.";
                            break;
                            default:
                            //do nothing
                        }

                        displayMatchInfo = true;

                        score += 50;

                        if(!muted)
                        {
                            tileMatchSound.load();
                            tileMatchSound.play();
                        }

                        if(score != tiles.length * 50 / 2)
                        {
                            timer.matchDelay();
                        }
                        else
                        {
                            timer.endDelay();
                        }
                    }
                    else
                    {
                        if(!muted)
                        {
                            tileFlipSound.load();
                            tileFlipSound.play();
                        }

                        timer.missDelay();
                    }
                }
            }
        }

        if(pauseButton.clicked(x, y) && score != tiles.length * 50 / 2)
        {
            if(!timer.isPaused() && !timer.isMatchDelayed() && !timer.isEndDelayed())
            {
                if(!muted)
                {
                    buttonSound.load();
                    buttonSound.play();
                }

                timer.pause();
                pauseButton.image = playButtonImg;
                pauseButton.x = canvas.width / 2 - originalPlayButtonSize * 2 - originalPlayButtonSize / 4;
                pauseButton.y = canvas.height / 2 - originalPlayButtonSize / 2 - originalPlayButtonSize / 8;
            }
            else if(!timer.isMatchDelayed() && !timer.isEndDelayed())
            {
                if(!muted)
                {
                    buttonSound.load();
                    buttonSound.play();
                }

                timer.unpause();
                pauseButton.image = pauseButtonImg;
                pauseButton.x = canvas.width - originalPlayButtonSize * 2;
                pauseButton.y = canvas.height - originalPlayButtonSize - 15;
            }
        }

        if(restartButton.clicked(x, y) && timer.isPaused())
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();

                matchingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.MATCHLEVEL;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }

        if(homeButton.clicked(x, y) && timer.isPaused())
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();

                matchingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.CHOOSEGAME;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }
    }
    else if(currentState == state.SORTINTRO1)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.SORTINTRO2;

            playButton.x = canvas.width / 2 - originalPlayButtonSize/2;
            playButton.y = canvas.height / 2 - originalPlayButtonSize/4;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.SORTINTRO2)
    {
        if(playButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.SORTLEVEL;

            level1Button.x = canvas.width / 8;
            level1Button.y = canvas.height / 2 - levelButtonHeight / 2;
            level2Button.x = canvas.width / 8 + levelButtonWidth * (3 / 2);
            level2Button.y = canvas.height / 2 - levelButtonHeight / 2;
            level3Button.x = canvas.width / 8 + levelButtonWidth * 3;
            level3Button.y = canvas.height / 2 - levelButtonHeight / 2;
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.SORTLEVEL)
    {
        if(level1Button.clicked(x, y) || level2Button.clicked(x, y) || level3Button.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            if(level1Button.clicked(x, y))
            {
                level = 1;
            }

            if(level2Button.clicked(x, y))
            {
                level = 2;
            }

            if(level3Button.clicked(x, y))
            {
                level = 3;
            }

            setSortLevelBoard();

            currentState = state.PLAYSORT;

            pauseButton.image = pauseButtonImg;
            pauseButton.x = sidebarLocalXOrigin + (binWidth*(1/8));
            pauseButton.y = canvas.height * (7/16);
            pauseButton.size = sortButtonSize;

            muteButton.x = sidebarLocalXOrigin + (binWidth*(9/16));
            muteButton.y = canvas.height * (7/16);
            muteButton.size = sortButtonSize;

            homeButton.x = canvas.width / 2 - originalPlayButtonSize * 2 - originalPlayButtonSize / 4;
            homeButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            homeButton.size = originalPlayButtonSize;

            restartButton.x = canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
            restartButton.y = canvas.height / 2 - originalPlayButtonSize / 2 - originalPlayButtonSize / 8;
            restartButton.size = originalPlayButtonSize;

            if(!muted)
            {
                backgroundMusic.pause();
                sortingMusic.currentTime = 0;
                sortingMusic.play();
            }

            timer.setTimerTime(timerTime);
            timer.start();
        }

        toggleAudio(x, y);
    }
    else if(currentState == state.PLAYSORT)
    {
    	if(itemsRemaining >= 1)
    	{
        	toggleAudio(x, y);
        }

        if(pauseButton.clicked(x, y) && itemsRemaining >= 1)
        {
            if(!timer.isPaused())
            {
                if(!muted)
                {
                    buttonSound.load();
                    buttonSound.play();
                }

                timer.pause();

                pauseButton.image = playButtonImg;
                pauseButton.x = canvas.width / 2 - originalPlayButtonSize * 2 - originalPlayButtonSize / 4;
                pauseButton.y = canvas.height / 2 - originalPlayButtonSize / 2 - originalPlayButtonSize / 8;
                pauseButton.size = originalPlayButtonSize;
            }
            else
            {
                if(!muted)
                {
                    buttonSound.load();
                    buttonSound.play();
                }

                timer.unpause();

                pauseButton.image = pauseButtonImg;
                pauseButton.x = sidebarLocalXOrigin + (binWidth*(1/8));
                pauseButton.y = canvas.height * (7/16);
                pauseButton.size = sortButtonSize;
            }
        }

        if(restartButton.clicked(x, y) && timer.isPaused())
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();

                sortingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.SORTLEVEL;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }

        if(homeButton.clicked(x, y) && timer.isPaused())
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();

                sortingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.CHOOSEGAME;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }
    }
    else if(currentState == state.END)
    {
        if(restartButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            if(gameTitle == "matching")
            {
                currentState = state.MATCHLEVEL;
            }
            else
            {
                currentState = state.SORTLEVEL;
            }
        }

        if(homeButton.clicked(x, y))
        {
            if(!muted)
            {
                buttonSound.load();
                buttonSound.play();
            }

            currentState = state.CHOOSEGAME;
        }

        toggleAudio(x, y);
    }
}

function mouseDownHandler(e)
{
    var x = (e.pageX - dCanvas.offsetLeft) * (canvas.width/dCanvas.width);
	var y = (e.pageY - dCanvas.offsetTop) * (canvas.height/dCanvas.height);

    if(currentState == state.PLAYSORT)
    {
        for(i = garbage.length - 1; i >= 0; i--)
        {
            if(garbage[i].clicked(x, y) && !mouseDown && garbage[i].y + garbageSize < canvas.height - binFrontHeight + fallSpeed)
            {
                dragImg = garbage[i].image;

                draggedGarbage = garbage[i];

                switch(garbage[i].image)
                {
                    case bananaMatchImg:
                    draggedGarbage.image = bananaGSImg;
                    break;
                    case bottleMatchImg:
                    draggedGarbage.image = bottleGSImg;
                    break;
                    case chipsMatchImg:
                    draggedGarbage.image = chipsGSImg;
                    break;
                    case newsPaperMatchImg:
                    draggedGarbage.image = newsPaperGSImg;
                    break;
                    case sodaCanMatchImg:
                    draggedGarbage.image = sodaCanGSImg;
                    break;
                    case appleMatchImg:
                    draggedGarbage.image = appleGSImg;
                    break;
                    case brokenPlateMatchImg:
                    draggedGarbage.image = brokenPlateGSImg;
                    break;
                    case canMatchImg:
                    draggedGarbage.image = canGSImg;
                    break;
                    case cardboardMatchImg:
                    draggedGarbage.image = cardboardGSImg;
                    break;
                    case cerealMatchImg:
                    draggedGarbage.image = cerealGSImg;
                    break;
                    case diaperMatchImg:
                    draggedGarbage.image = diaperGSImg;
                    break;
                    case glassBottleMatchImg:
                    draggedGarbage.image = glassBottleGSImg;
                    break;
                    case glassJarMatchImg:
                    draggedGarbage.image = glassJarGSImg;
                    break;
                    case grassMatchImg:
                    draggedGarbage.image = grassGSImg;
                    break;
                    case leafMatchImg:
                    draggedGarbage.image = leafGSImg;
                    break;
                    case papersMatchImg:
                    draggedGarbage.image = papersGSImg;
                    break;
                    case mailMatchImg:
                    draggedGarbage.image = mailGSImg;
                    break;
                    case plasticBagMatchImg:
                    draggedGarbage.image = plasticBagGSImg;
                    break;
                    case pumpkinMatchImg:
                    draggedGarbage.image = pumpkinGSImg;
                    break;
                    case styrofoamMatchImg:
                    draggedGarbage.image = styrofoamGSImg;
                    break;
                    case milkCartonMatchImg:
                    draggedGarbage.image = milkGSImg;
                    break;
                    case juiceMatchImg:
                    draggedGarbage.image = juiceGSImg;
                    break;
                    case eggsMatchImg:
                    draggedGarbage.image = eggsGSImg;
                    break;
                    case strawAndLidMatchImg:
                    draggedGarbage.image = strawGSImg;
                    break;
                    case takeOutBoxMatchImg:
                    draggedGarbage.image = chineseGSImg;
                    break;
                    case stickMatchImg:
                    draggedGarbage.image = stickGSImg;
                    break;
                    case candyMatchImg:
                    draggedGarbage.image = candyGSImg;
                    break;
                    case petWasteMatchImg:
                    draggedGarbage.image = poopGSImg;
                    break;
                    case paperRollMatchImg:
                    draggedGarbage.image = paperRollGSImg;
                    break;
                    case paperBagMatchImg:
                    draggedGarbage.image = paperBagGSImg;
                    break;
                    case aluminumFoilMatchImg:
                    draggedGarbage.image = aluminumFoilGSImg;
                    break;
                    case coffeeLidMatchImg:
                    draggedGarbage.image = coffeeLidGSImg;
                    break;
                    default:
                    //do nothing
                }

                dragOffsetX = garbage[i].x - x;
                dragOffsetY = garbage[i].y - y;

                dragX = x + dragOffsetX;
                dragY = y + dragOffsetY;

                garbage.splice(i, 1);

                mouseDown = true;
            }
        }
    }
}

function mouseMoveHandler(e)
{
    var x = (e.pageX - dCanvas.offsetLeft) * (canvas.width/dCanvas.width);
	var y = (e.pageY - dCanvas.offsetTop) * (canvas.height/dCanvas.height);

    if(currentState == state.PLAYSORT)
    {
        if(mouseDown)
        {
            dragX = x + dragOffsetX;
            dragY = y + dragOffsetY;
        }
    }
}

function mouseUpHandler(e)
{
    if(currentState == state.PLAYSORT)
    {
        if(mouseDown)
        {
            var validPlacement = true;

            var tempX = draggedGarbage.x;
            var tempY = draggedGarbage.y;

            draggedGarbage.x = dragX;
            draggedGarbage.y = dragY;

            for(i = 0; i < garbage.length; i++)
            {
                if(draggedGarbage.isColliding(garbage[i]) && draggedGarbage.y + draggedGarbage.size < canvas.height - binFrontHeight)
                {
                    validPlacement = false;
                }
            }

            if((dragY < 0) || (dragX < 0) || (dragX + garbageSize > canvas.width - binWidth) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < paperColumnStart &&
                draggedGarbage.type == paper) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > paperColumnEnd &&
                draggedGarbage.type == paper) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < comingledColumnStart &&
                draggedGarbage.type == comingled) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > comingledColumnEnd &&
                draggedGarbage.type == comingled) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < organicsColumnStart &&
                draggedGarbage.type == organics) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > organicsColumnEnd &&
                draggedGarbage.type == organics) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < landfillColumnStart &&
                draggedGarbage.type == landfill) ||
               (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > landfillColumnEnd &&
                draggedGarbage.type == landfill))
            {
                validPlacement = false;
            }

            if(validPlacement)
            {
                draggedGarbage.image = dragImg;
                garbage.push(draggedGarbage);
            }
            else
            {
                draggedGarbage.image = dragImg;
                draggedGarbage.x = tempX;
                draggedGarbage.y = tempY;
                garbage.push(draggedGarbage);
            }
        }
    }

    mouseDown = false;
}

//remap touch event as mouse event
function touch2Mouse(e)
{
  var theTouch = e.changedTouches[0];
  var mouseEv;

  switch(e.type)
  {
    case "touchstart": mouseEv="mousedown";  break;
    case "touchend":   mouseEv="mouseup"; break;
    case "touchmove":  mouseEv="mousemove"; break;
    default: return;
  }

  var mouseEvent = document.createEvent("MouseEvent");
  mouseEvent.initMouseEvent(mouseEv, true, true, window, 1, theTouch.screenX, theTouch.screenY, theTouch.clientX, theTouch.clientY, false, false, false, false, 0, null);
  theTouch.target.dispatchEvent(mouseEvent);
    //prevent activating multiple events at once
  e.preventDefault();
}

function toggleAudio(x, y)
{
    if(muteButton.clicked(x, y) && !muted)
    {
        if(currentState == state.PLAYMATCH)
        {
            matchingMusic.pause();
        }
        else if(currentState == state.PLAYSORT)
        {
            sortingMusic.pause();
        }
        else
        {
            backgroundMusic.pause();
        }

        muted = true;
        muteButton.image = unmuteImg;
    }
    else if(muteButton.clicked(x, y) && muted)
    {
        if(currentState == state.PLAYMATCH)
        {
            matchingMusic.play();
        }
        else if(currentState == state.PLAYSORT)
        {
            sortingMusic.play();
        }
        else
        {
            backgroundMusic.play();
        }

        muted = false;
        muteButton.image = muteImg;
    }
}

function drawGameBoard()
{
    ctx.beginPath();
    ctx.rect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#FCE21E";
    ctx.fill();
    ctx.closePath();
}

function drawMatchInfo()
{
    ctx.drawImage(matchInfoImage, 90, canvas.height - 115, 100, 100);

    ctx.font = "20px Comic Sans MS";
    ctx.fillStyle = "#000000";
    ctx.textAlign = "left";
    ctx.textBaseline = "middle";
    ctx.fillText(matchInfoString1, 210, canvas.height - 75);
    ctx.fillText(matchInfoString2, 210, canvas.height - 50);
}

function drawScore()
{
    ctx.font = "bold 48px Comic Sans MS";
    ctx.fillStyle = "#201A91";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("Score: " + score, canvas.width / 2, tileOffsetTop / 2 + 10);
}

function drawTiles()
{
    for(i = 0; i < tiles.length; i++)
    {
        if(tiles[i].flipped || tiles[i].matched)
        {
            ctx.drawImage(cardFrontImg, tiles[i].x, tiles[i].y, tiles[i].size, tiles[i].size);

            var borderSize = tiles[i].size * (7/8);
            ctx.drawImage(tiles[i].image, tiles[i].x + borderSize, tiles[i].y + borderSize, tiles[i].size - (borderSize * 2), tiles[i].size - (borderSize * 2));
        }
        else
        {
            ctx.drawImage(matchingCardImg, tiles[i].x, tiles[i].y, tiles[i].size, tiles[i].size);
        }
    }
}

function drawLoadingScreen()
{
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.drawImage(loadingImg, 0, 0, canvas.width, canvas.height);

    drawEmptyLoadingBar();
    drawLoadingBar();

    if(numberLoaded >= numberOfAssets){
        currentState = state.MAININTRO;
        backgroundMusic.play();
    }
}

function drawEmptyLoadingBar()
{
    ctx.beginPath();
    ctx.rect(0, canvas.height/2, canvas.width, canvas.height/20);
    ctx.fillStyle = "#999";
    ctx.fill();
    ctx.closePath();
}

function drawLoadingBar()
{
    ctx.beginPath();
    ctx.rect(0, canvas.height/2, canvas.width * (numberLoaded/numberOfAssets), canvas.height/20);
    ctx.fillStyle = "#0F0";
    ctx.fill();
    ctx.closePath();
}

function drawMainIntroScreen()
{
    ctx.drawImage(mainIntroImg, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawWelcome1Screen()
{
    ctx.drawImage(welcome1Img, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawWelcome2Screen()
{
    ctx.drawImage(welcome2Img, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawChooseGameScreen()
{
    ctx.drawImage(chooseGameImg, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(matchingButton.image, matchingButton.x, matchingButton.y, matchingButton.width, matchingButton.height);
    ctx.drawImage(sortingButton.image, sortingButton.x, sortingButton.y, sortingButton.width, sortingButton.height);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawMatchingIntro1()
{
    ctx.drawImage(matchingIntro1Img, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawMatchingIntro2()
{
    ctx.drawImage(matchingIntro2Img, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawMatchingIntro3()
{
    ctx.drawImage(matchingIntro3Img, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawMatchingChooseLevelScreen()
{
    ctx.drawImage(matchingLevelSelectImg, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(level1Button.image, level1Button.x, level1Button.y, level1Button.width, level1Button.height);
    ctx.drawImage(level2Button.image, level2Button.x, level2Button.y, level2Button.width, level2Button.height);
    ctx.drawImage(level3Button.image, level3Button.x, level3Button.y, level3Button.width, level3Button.height);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawSortingChooseLevelScreen()
{
    ctx.drawImage(sortingLevelSelectImg, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(level1Button.image, level1Button.x, level1Button.y, level1Button.width, level1Button.height);
    ctx.drawImage(level2Button.image, level2Button.x, level2Button.y, level2Button.width, level2Button.height);
    ctx.drawImage(level3Button.image, level3Button.x, level3Button.y, level3Button.width, level3Button.height);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawSortingIntro1()
{
    ctx.drawImage(sortingIntro1Img, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawSortingIntro2()
{
    ctx.drawImage(sortingIntro2Img, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(playButton.image, playButton.x, playButton.y, playButton.size, playButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawEndGameScreen()
{
    if(gameTitle == "matching")
    {
        ctx.drawImage(endScreenMatchingImg, 0, 0, canvas.width, canvas.height);
        ctx.font = "bold 48px Comic Sans MS";
        ctx.fillStyle = "#201A91";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(score, canvas.width / 2 - 150, canvas.height / 2);
    }
    else
    {
        ctx.drawImage(endScreenSortingImg, 0, 0, canvas.width, canvas.height);
        ctx.font = "bold 28px Comic Sans MS";
        ctx.fillStyle = "#201A91";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(recyclingSorted + landfillSorted + " of " + startingGarbageCount + " items sorted correctly", canvas.width / 2 - 150, canvas.height / 2);
    }

    ctx.drawImage(restartButton.image, restartButton.x, restartButton.y, restartButton.size, restartButton.size);
    ctx.drawImage(homeButton.image, homeButton.x, homeButton.y, homeButton.size, homeButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);


}

function drawPauseButton()
{
    ctx.drawImage(pauseButton.image, pauseButton.x, pauseButton.y, pauseButton.size, pauseButton.size);
}

function drawMuteButton()
{
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawEmptyBar()
{
    ctx.beginPath();
    ctx.rect(0, 0, canvas.width, timerBarHeight);
    ctx.fillStyle = "#00FF00";
    ctx.fill();
    ctx.closePath();
}

function drawTimerBar()
{
    ctx.beginPath();
    ctx.rect(0, 0, timerBarWidth, timerBarHeight);
    ctx.fillStyle = "#FF0000";
    ctx.fill();
    ctx.closePath();
}

function drawTime()
{
    ctx.font = "bold 16px Comic Sans MS";
    ctx.fillStyle = "#000000";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(timeElapsed, 30, canvas.height - 20);
}

function drawPauseScreen()
{
    ctx.drawImage(pauseScreenImg, 0, 0, canvas.width, canvas.height);

    ctx.drawImage(pauseButton.image, pauseButton.x, pauseButton.y, pauseButton.size, pauseButton.size);
    ctx.drawImage(restartButton.image, restartButton.x, restartButton.y, restartButton.size, restartButton.size);
    ctx.drawImage(homeButton.image, homeButton.x, homeButton.y, homeButton.size, homeButton.size);
    ctx.drawImage(muteButton.image, muteButton.x, muteButton.y, muteButton.size, muteButton.size);
}

function drawSortingGame()
{
    ctx.drawImage(sortingBackgroundImg, 0, 0, canvas.width, canvas.height);

    ctx.drawImage(paperBackImg, paperColumnStart, canvas.height - binFrontHeight - binBackHeight, binWidth, binBackHeight);
    ctx.drawImage(comingledBackImg, comingledColumnStart, canvas.height - binFrontHeight - binBackHeight, binWidth, binBackHeight);
    ctx.drawImage(organicsBackImg, organicsColumnStart, canvas.height - binFrontHeight - binBackHeight, binWidth, binBackHeight);
    ctx.drawImage(landfillBackImg, landfillColumnStart, canvas.height - binFrontHeight - binBackHeight, binWidth, binBackHeight);

    for(i = 0; i < garbage.length; i++)
    {
        ctx.drawImage(garbage[i].image, garbage[i].x, garbage[i].y, garbage[i].size, garbage[i].size);
    }

    if(mouseDown)
    {
        ctx.drawImage(draggedGarbage.image, draggedGarbage.x, draggedGarbage.y, draggedGarbage.size, draggedGarbage.size);
        ctx.drawImage(dragImg, dragX, dragY, garbageSize, garbageSize);
    }

    ctx.drawImage(paperFrontImg, paperColumnStart, canvas.height - binFrontHeight, binWidth, binFrontHeight);
    ctx.drawImage(comingledFrontImg, comingledColumnStart, canvas.height - binFrontHeight, binWidth, binFrontHeight);
    ctx.drawImage(organicsFrontImg, organicsColumnStart, canvas.height - binFrontHeight, binWidth, binFrontHeight);
    ctx.drawImage(landfillFrontImg, landfillColumnStart, canvas.height - binFrontHeight, binWidth, binFrontHeight);

    drawSidebar();
}

function drawSidebar()
{
    //sidebar background
    ctx.beginPath();
    ctx.rect(binWidth * 4, 0, binWidth, canvas.height);
    ctx.fillStyle = "#83ccee";
    ctx.fill();
    ctx.closePath();

    //"Time Remaining" text
    ctx.font = "25px Comic Sans MS";
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.fillText("Time", sidebarLocalXOrigin + (binWidth*(4/8)), canvas.height * (1/8) - 20);
    ctx.fillText("Remaining", sidebarLocalXOrigin + (binWidth*(4/8)), canvas.height * (1/8) + 10);

    //yellow box that contains "Score:"
    ctx.beginPath();
    ctx.rect(sidebarLocalXOrigin + (binWidth*(1/8)), canvas.height *(3/4)-80, binWidth*(3/4), 60);
    ctx.fillStyle = "#f4c831";
    ctx.fill();
    ctx.closePath();
    ctx.font = "25px Comic Sans MS";
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.fillText("Score", sidebarLocalXOrigin + (binWidth*(4/8)), canvas.height *(3/4) - 42);

    //white box that surrounds the percentage score
    ctx.beginPath();
    ctx.rect(sidebarLocalXOrigin + (binWidth*(2/8)), canvas.height * (3/4), binWidth/2, 50);
    ctx.fillStyle = "white";
    ctx.fill();
    ctx.closePath();

    //the percentage text
    ctx.font = "25px Comic Sans MS";
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.fillText(scorePercentage + "%", sidebarLocalXOrigin + (binWidth*(4/8)), canvas.height *(3/4) + 35);

    //percentage description text
    ctx.font = "25px Comic Sans MS";
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.fillText("Diverted from", sidebarLocalXOrigin + (binWidth*(4/8)), canvas.height *(7/8)+15);
    ctx.fillText("the landfill", sidebarLocalXOrigin + (binWidth*(4/8)), canvas.height *(7/8)+50);

    drawEmptyCircle();
    drawFilledCircle();
}

function drawEmptyCircle()
{
    ctx.beginPath();
    ctx.arc(sidebarLocalXOrigin + binWidth / 2, canvas.height / 4 + timerCircleRadius / 2, timerCircleRadius, 0, Math.PI * 2);
    ctx.fillStyle = "#F4C831";
    ctx.fill();
    ctx.closePath();
}

function drawFilledCircle()
{
    ctx.beginPath();
    ctx.moveTo(sidebarLocalXOrigin + binWidth / 2, canvas.height / 4 + timerCircleRadius / 2);
    ctx.arc(sidebarLocalXOrigin + binWidth / 2, canvas.height / 4 + timerCircleRadius / 2, timerCircleRadius, startAngle, endAngle);
    ctx.fillStyle = "#FFFFFF";
    ctx.fill();
    ctx.closePath();
}

function changeChooseButtonSize()
{
    if(chooseButtonSize < 250 && increaseChooseButtonSize)
    {
        chooseButtonSize += 1;

        matchingButton.x -= 0.5;
        matchingButton.y -= 0.5;

        matchingButton.width = chooseButtonSize;
        matchingButton.height = chooseButtonSize;

        sortingButton.x -= 0.5;
        sortingButton.y -= 0.5;

        sortingButton.width = chooseButtonSize;
        sortingButton.height = chooseButtonSize;

        if(chooseButtonSize >= 250)
        {
            increaseChooseButtonSize = false;
        }
    }
    else
    {
        chooseButtonSize -= 1;

        matchingButton.x += 0.5;
        matchingButton.y += 0.5;

        matchingButton.width = chooseButtonSize;
        matchingButton.height = chooseButtonSize;

        sortingButton.x += 0.5;
        sortingButton.y += 0.5;

        sortingButton.width = chooseButtonSize;
        sortingButton.height = chooseButtonSize;

        if(chooseButtonSize <= 200)
        {
            increaseChooseButtonSize = true;
        }
    }
}

function changePlayButtonSize()
{
    if(currentPlayButtonSize < 125 && increasePlayButtonSize)
    {
        currentPlayButtonSize += 0.5;

        playButton.x -= 0.25;
        playButton.y -= 0.25;

        playButton.size = currentPlayButtonSize;

        if(currentPlayButtonSize >= 125)
        {
            increasePlayButtonSize = false;
        }
    }
    else
    {
        currentPlayButtonSize -= 0.5;

        playButton.x += 0.25;
        playButton.y += 0.25;

        playButton.size = currentPlayButtonSize;

        if(currentPlayButtonSize <= 100)
        {
            increasePlayButtonSize = true;
        }
    }
}

function changeLevelButtonSize()
{
    if(levelButtonWidth < 150 && increaseLevelButtonSize)
    {
        levelButtonWidth += 0.5;
        levelButtonHeight += 0.2;

        level1Button.width = levelButtonWidth;
        level1Button.height = levelButtonHeight;

        level1Button.x -= 0.25;
        level1Button.y -= 0.1;

        level2Button.width = levelButtonWidth;
        level2Button.height = levelButtonHeight;

        level2Button.x -= 0.25;
        level2Button.y -= 0.1;

        level3Button.width = levelButtonWidth;
        level3Button.height = levelButtonHeight;

        level3Button.x -= 0.25;
        level3Button.y -= 0.1;

        if(levelButtonWidth >= 150)
        {
            increaseLevelButtonSize = false;
        }
    }
    else
    {
        levelButtonWidth -= 0.5;
        levelButtonHeight -= 0.2;

        level1Button.width = levelButtonWidth;
        level1Button.height = levelButtonHeight;

        level1Button.x += 0.25;
        level1Button.y += 0.1;

        level2Button.width = levelButtonWidth;
        level2Button.height = levelButtonHeight;

        level2Button.x += 0.25;
        level2Button.y += 0.1;

        level3Button.width = levelButtonWidth;
        level3Button.height = levelButtonHeight;

        level3Button.x += 0.25;
        level3Button.y += 0.1;

        if(levelButtonWidth <= 125)
        {
            increaseLevelButtonSize = true;
        }
    }
}

function changeRestartAndHomeButtonSize()
{
    if(currentPlayButtonSize < 125 && increasePlayButtonSize)
    {
        currentPlayButtonSize += 0.5;

        restartButton.x -= 0.25;
        restartButton.y -= 0.25;

        restartButton.size = currentPlayButtonSize;

        homeButton.x -= 0.25;
        homeButton.y -= 0.25;

        homeButton.size = currentPlayButtonSize;

        if(currentPlayButtonSize >= 125)
        {
            increasePlayButtonSize = false;
        }
    }
    else
    {
        currentPlayButtonSize -= 0.5;

        restartButton.x += 0.25;
        restartButton.y += 0.25;

        restartButton.size = currentPlayButtonSize;

        homeButton.x += 0.25;
        homeButton.y += 0.25;

        homeButton.size = currentPlayButtonSize;

        if(currentPlayButtonSize <= 100)
        {
            increasePlayButtonSize = true;
        }
    }
}

function draw()
{

    if(currentState == state.LOADING){
        drawLoadingScreen();

    }else if(currentState == state.MAININTRO)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawMainIntroScreen();

        changePlayButtonSize();
    }
    else if(currentState == state.WELCOME1)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawWelcome1Screen();

        changePlayButtonSize();
    }
    else if(currentState == state.WELCOME2)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawWelcome2Screen();

        changePlayButtonSize();
    }
    else if(currentState == state.CHOOSEGAME)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawChooseGameScreen();

        changeChooseButtonSize();
    }
    else if(currentState == state.MATCHINTRO1)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawMatchingIntro1();

        changePlayButtonSize();
    }
    else if(currentState == state.MATCHINTRO2)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawMatchingIntro2();

        changePlayButtonSize();
    }
    else if(currentState == state.MATCHINTRO3)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawMatchingIntro3();

        changePlayButtonSize();
    }
    else if(currentState == state.MATCHLEVEL)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawMatchingChooseLevelScreen();

        changeLevelButtonSize();
    }
    else if(currentState == state.SORTINTRO1)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawSortingIntro1();

        changePlayButtonSize();
    }
    else if(currentState == state.SORTINTRO2)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawSortingIntro2();

        changePlayButtonSize();
    }
    else if(currentState == state.SORTLEVEL)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawSortingChooseLevelScreen();

        changeLevelButtonSize();
    }
    else if(currentState == state.PLAYMATCH)
    {
        timer.update();

        if(!timer.isPaused() && !timer.isMatchDelayed() && !timer.isEndDelayed())
        {
            percent = timer.getRunTime() / timer.getTimerTime();

            timerBarWidth = percent * canvas.width;

            timeElapsed = Number(timer.getRunTime()/1000).toFixed(2);
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawGameBoard();
        drawScore();
        drawEmptyBar();
        drawTimerBar();
        //drawTime();
        drawTiles();

        if(displayMatchInfo)
        {
            drawMatchInfo();
        }

        if(timer.isPaused())
        {
            muteButton.x = canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
            muteButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            muteButton.size = originalPlayButtonSize;
            drawPauseScreen();
        }
        else
        {
            drawPauseButton();
            muteButton.x = canvas.width - soundButtonSize - (soundButtonSize/8);
            muteButton.y = soundButtonSize / 2;
            muteButton.size = soundButtonSize;
            drawMuteButton();
        }

        if(score == tiles.length * 50 / 2 && !timer.isMatchDelayed() && !timer.isEndDelayed())
        {
            if(!muted)
            {
                matchingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }

        if(numberTilesFlipped == 2 && !timer.isMissDelayed())
        {
            numberTilesFlipped = 0;
            tiles[firstFlippedTileIndex].flipped = false;
            tiles[secondFlippedTileIndex].flipped = false;
        }

        if(timer.getRunTime() > timer.getTimerTime() && !timer.isPaused() && !timer.isMatchDelayed() && !timer.isEndDelayed())
        {
            if(!muted)
            {
                matchingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }
    }
    else if(currentState == state.PLAYSORT)
    {
        timer.update();

        if(!timer.isPaused())
        {
            percent = timer.getRunTime() / timer.getTimerTime();

            endAngle = startAngle + (percent * Math.PI * 2);

            timeElapsed = Number(timer.getRunTime()/1000).toFixed(2);
        }

        //remove garbage that went into a bin and increase the score percentage
        for(i = garbage.length - 1; i >= 0; i--)
        {
            if(garbage[i].y > canvas.height - binFrontHeight)
            {
                if(!muted)
                {
                    tileMatchSound.load();
                    tileMatchSound.play();
                }

                if(garbage[i].type != landfill)
                {
                    recyclingSorted++;
                    scorePercentage = Number(recyclingSorted / startingGarbageCount * 100).toFixed(0);
                }
                else
                {
                    landfillSorted++;
                }

                garbage.splice(i, 1);
                itemsRemaining--;

                if(itemsRemaining < 1)
                {
                    timer.missDelay();
                }
            }
        }

        if(timer.getRunTime() > lastDropTime && garbageQueue.length > 0 && !timer.isPaused())
        {
            garbage.push(garbageQueue.pop());
            lastDropTime += dropGarbageInterval;
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawSortingGame();

        //drawTime();

        if(timer.isPaused())
        {
            muteButton.x = canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
            muteButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            muteButton.size = originalPlayButtonSize;
            drawPauseScreen();
        }
        else
        {
            pauseButton.x = sidebarLocalXOrigin + binWidth / 4 - sortButtonSize / 2;
            pauseButton.y = canvas.height * (7/16);
            pauseButton.size = sortButtonSize;
            drawPauseButton();
            muteButton.x = canvas.width - binWidth / 4 - sortButtonSize / 2;
            muteButton.y = canvas.height * (7/16);
            muteButton.size = sortButtonSize;
            drawMuteButton();
        }

        if(timer.getRunTime() > timer.getTimerTime() && !timer.isPaused())
        {
            if(!muted)
            {
                sortingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }

        if(itemsRemaining < 1 && !timer.isMissDelayed())
        {
            if(!muted)
            {
                sortingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y = canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
        }

        if(!timer.isPaused())
        {
            for(i = 0; i < garbage.length; i++)
            {
                for(j = 0; j < garbage.length; j++)
                {
                    if(i != j)
                    {
                        if(garbage[i].isColliding(garbage[j]) && garbage[i].y < garbage[j].y)
                        {
                            garbage[i].falling = false;
                        }
                    }
                }

                if(garbage[i].isColliding(draggedGarbage) && mouseDown)
                {
                    garbage[i].falling = false;
                }

                if(garbage[i].y + garbage[i].size < canvas.height - binFrontHeight)
                {
                    if(garbage[i].falling)
                    {
                        garbage[i].y += fallSpeed;
                    }
                }
                else if((garbage[i].x >= paperColumnStart &&
                         garbage[i].x + garbageSize <= paperColumnEnd &&
                         garbage[i].type == paper) ||
                        (garbage[i].x >= comingledColumnStart &&
                         garbage[i].x + garbageSize <= comingledColumnEnd &&
                         garbage[i].type == comingled) ||
                        (garbage[i].x >= organicsColumnStart &&
                         garbage[i].x + garbageSize <= organicsColumnEnd &&
                         garbage[i].type == organics)  ||
                        (garbage[i].x >= landfillColumnStart &&
                         garbage[i].x + garbageSize <= landfillColumnEnd &&
                         garbage[i].type == landfill))
                {
                    if(garbage[i].falling)
                    {
                        garbage[i].y += fallSpeed;
                    }
                }

                garbage[i].falling = true;
            }
        }
    }
    else if(currentState == state.END)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawEndGameScreen();

        changeRestartAndHomeButtonSize();
    }

    dCtx.drawImage(canvas, 0, 0, dCanvas.width, dCanvas.height);

    requestAnimationFrame(draw);
}

loadAssets();

draw();
</script>

</body>
</html>
